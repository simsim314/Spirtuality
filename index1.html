<!-- HTML5 code -->
<html>
<head>
  <title>Hex Clock</title>
</head>
<body>
  <canvas id="canvas" width="800" height="600"></canvas>
</body>
</html>

<!-- JavaScript code -->
<script>

setInterval(clock, 50);

function draw_arrow(duration_units, factor, color, r, w, canvas) {
  // sec is the remaining part of the duration_units after dividing by the factor
  let sec = duration_units - factor * Math.floor(duration_units / factor);
  // angle is the angle of the arrow relative to the vertical axis (y-axis)
  let angle = -Math.PI / 2 + sec / factor * 2 * Math.PI;
  const canvas1 = document.getElementById("canvas");
  const ctx = canvas1.getContext("2d");
	
  let x = 450;
  let y = 300;
  let x1 = Math.round(450 + r * 210 * Math.cos(angle));
  let y1 = Math.round(300 + r * 200 * Math.sin(angle));
  ctx.fillStyle = color
  
  ctx.beginPath();
  ctx.moveTo(x, y);
  ctx.lineTo(x1, y1);
  ctx.lineWidth = w;
  ctx.strokeStyle = color;
  ctx.stroke();
}

function ymdh(time) {
  const year = time.getFullYear();
  const month = time.getMonth() + 1; // getMonth returns 0-based month
  const day = time.getDate();
  const hour = time.getHours();
  return [year, month, day, hour];
}

function clock() {
    let date = new Date();
	
	const timezoneOffset = date.getTimezoneOffset();
	dt = 5 - timezoneOffset / 60

	if (date.getHours() < 6 + dt) {
	  date = new Date(date.getTime() - 24 * 60 * 60 * 1000);
	} 
	
    const then = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 6 + dt, 0, 0);
	const now = new Date();
	
    const duration = now - then;
    const duration_in_s = duration / 1000;
    const unit = 1440 * 60 / (256 * 256);
    let duration_units = Math.floor(duration_in_s / unit);
	
	const canvas = document.getElementById("canvas");
	const ctx = canvas.getContext("2d");
	ctx.fillStyle = "black";
	ctx.font = "50px serif";
	ctx.fillRect(0, 0, 800, 600);
    ctx.fillStyle = "white";
	

    const tm = duration_units.toString(16);
    const tm_formatted = tm.slice(0, 2) + ":" + tm.slice(2, 4);

    ctx.fillText(tm_formatted, 20, 230);
	duration_units = duration_in_s / unit;
	
    for (let i = 0; i < 16; i++) {
      const angle = (-Math.PI / 2) + (i / 16) * 2 * Math.PI;
      const r = 1.2;
      const x = 425 + r * 210 * Math.cos(angle);
      const y = 300 + r * 200 * Math.sin(angle);
      ctx.fillText(i.toString(16), x, y);
    }

    const colors = ["green", "red", "blue", "white"];
	
    for (let i = 0; i < 4; i++) {
      draw_arrow(duration_units, 16 ** (i + 1), colors[i], 1 - 0.15 * i, 2 ** i);
    }

}

</script>
